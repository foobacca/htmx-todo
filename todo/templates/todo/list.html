{% extends "todo/base.html" %}
{% load static %}

{% block content %}
    <h2>Search</h2>
    <form action="{% url 'todo:list' %}" method="GET" class="tool-bar">
      <label for="search">Search Term</label>
      <input
        id="search"
        type="search"
        name="q"
        value="{{ search_term }}"
        hx-get="{% url 'todo:list' %}"
        hx-trigger="search, keyup delay:200ms changed"
        hx-target="tbody"
        hx-push-url="true"
        hx-indicator="#spinner"
      />
      <img
        id="spinner"
        class="htmx-indicator"
        src="{% static 'img/spinning-circles.svg' %}"
        alt="Request in flight ..."
      />
      <input type="submit" value="Search">
    </form>
    <h2>Todo List</h2>
    {% if search_term %}
    <p>There are {{ todo_count }} items that match "{{ search_term }}".</p>
    {% else %}
    <p>There are {{ todo_count }} items.</p>
    {% endif %}
    <p>
      <a href="{% url 'todo:new' %}">Add Todo</a>
    </p>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
      {% include "todo/todo_rows.html" %}
      {% if todo_list.has_next %}
      <tr>
        <td colspan="4" style="text-align: center">
          <span
              hx-target="closest tr"
              hx-trigger="revealed"
              hx-swap="outerHTML"
              hx-select="tbody > tr"
              hx-get="?page={{ todo_list.next_page_number }}"
          >
          Load More
          </span>
        </td>
      </tr>
      {% endif %}
      </tbody>
    </table>
{% endblock content %}

